<!-- templates/patient_base.html -->
{% extends "main_layout.html" %}
{% block content %}
<div class="patient-section">
    <h2>Patient Database</h2>
    
    <div class="import-section">
        <a href="{{ url_for('import_kaggle_dataset') }}" class="btn import-btn" onclick="return confirm('Are you sure you want to update dataset?')">Update Dataset</a>
    </div>

    <div class="add-patient-form">
        <h3>Add New Patient</h3>
        <form method="POST" action="{{ url_for('add_patient') }}">
            <div class="form-row">
                <div class="form-group">
                    <select name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" name="age" placeholder="Age" min="0" max="120" required>
                </div>
                <div class="form-group">
                    <select name="hypertension" required>
                        <option value="">Hypertension</option>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <select name="ever_married" required>
                        <option value="">Ever Married</option>
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="work_type" required>
                        <option value="">Work Type</option>
                        <option value="Private">Private</option>
                        <option value="Self-employed">Self-employed</option>
                        <option value="Govt_job">Government Job</option>
                        <option value="children">Children</option>
                        <option value="Never_worked">Never worked</option>
                    </select>
                </div>
                <div class="form-group">
                    <select name="residence_type" required>
                        <option value="">Residence Type</option>
                        <option value="Rural">Rural</option>
                        <option value="Urban">Urban</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <input type="number" name="avg_glucose_level" placeholder="Glucose Level in mg/dL" step="0.01" min="0" max="500" required>
                </div>
                <div class="form-group">
                    <input type="number" name="bmi" placeholder="BMI" step="0.01" min="10" max="50" required>
                </div>
                <div class="form-group">
                    <select name="smoking_status" required>
                        <option value="">Smoking Status</option>
                        <option value="never smoked">Never Smoked</option>
                        <option value="formerly smoked">Formerly Smoked</option>
                        <option value="smokes">Smokes</option>
                        <option value="Unknown">Unknown</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="btn">Add Patient</button>
        </form>
    </div>

    <div class="patient-list">
        <h3>Patient List</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Gender</th>
                    <th>Age</th>
                    <th>Hypertension</th>
                    <th>Risk Level</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                <tr>
                    <td>{{ patient._id }}</td>
                    <td>{{ patient.gender }}</td>
                    <td>{{ patient.age }}</td>
                    <td>{{ "Yes" if patient.hypertension == 1 else "No" }}</td>
                    <td>{{ "%.1f"|format(patient.stroke_risk * 100) if patient.stroke_risk else "N/A" }}%</td>
                    <td>
                        <a href="{{ url_for('patient_info', patient_id=patient._id) }}" class="btn">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.patient-section {
    padding: 20px;
}

.import-section {
    margin: 20px 0;
    text-align: right;
}

.import-btn {
    background-color: #28a745;
}

.import-btn:hover {
    background-color: #218838;
}

.add-patient-form {
    margin-bottom: 30px;
    padding: 20px;
    background-color: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
}

.form-row {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}

.form-group {
    flex: 1;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-group select {
    background-color: white;
}

table {
    width: 100%;
    border-collapse: collapse;
    background-color: rgba(255, 255, 255, 0.9);
    margin-top: 20px;
}

th, td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
}

th {
    background-color: #456789;
    color: white;
}

tr:nth-child(even) {
    background-color: rgba(240, 240, 240, 0.9);
}

tr:hover {
    background-color: rgba(220, 220, 220, 0.9);
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    text-decoration: none;
    display: inline-block;
}

button.btn {
    background-color: #456789;
}

button.btn:hover {
    background-color: #567890;
}

h2, h3 {
    color: #234567;
    margin-bottom: 20px;
}

.alert {
    padding: 10px;
    margin: 10px 0;
    border-radius: 4px;
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
}

.alert-error {
    background-color: #f8d7da;
    color: #721c24;
}
</style>
{% endblock %}